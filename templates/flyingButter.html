<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Butterfly Button</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Full-page background */
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-image: url("../static/images/4102d3c6ba76749a51fb62d1117e20e0.gif");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      button {
        position: relative;
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
        outline-offset: 4px;
        transition: filter 250ms;
        user-select: none;
        touch-action: manipulation;
        margin-top: 300px;
      }

      .shadow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 12px;
        background: hsl(0deg 0% 0% / 0.25);
        will-change: transform;
        transform: translateY(2px);
        transition: transform 600ms cubic-bezier(0.3, 0.7, 0.4, 1);
      }

      .edge {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 12px;
        background: linear-gradient(
          to left,
          hsl(125, 86%, 11%) 0%,
          hsl(110, 52%, 17%) 8%,
          hsl(118, 71%, 42%) 92%,
          hsl(126, 88%, 6%) 100%
        );
      }

      .front {
        display: block;
        position: relative;
        padding: 12px 27px;
        border-radius: 12px;
        font-size: 1.1rem;
        color: white;
        background: hsl(116, 66%, 41%);
        will-change: transform;
        transform: translateY(-4px);
        transition: transform 600ms cubic-bezier(0.3, 0.7, 0.4, 1);
      }

      button:hover {
        filter: brightness(110%);
      }

      button:hover .front {
        transform: translateY(-6px);
        transition: transform 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5);
      }

      button:active .front {
        transform: translateY(-2px);
        transition: transform 34ms;
      }

      button:hover .shadow {
        transform: translateY(4px);
        transition: transform 250ms cubic-bezier(0.3, 0.7, 0.4, 1.5);
      }

      button:active .shadow {
        transform: translateY(1px);
        transition: transform 34ms;
      }

      button:focus:not(:focus-visible) {
        outline: none;
      }

      /* Modal styles */
      .modal-content {
        background-image: url("../static/images/new_popup_bg.webp");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        color: rgb(255, 255, 255);
      }

      .modal-body p {
        font-size: 20px;
      }

      .modal-body .btn {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
      }

      #myModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      /* Position button at the bottom center */
      .button-container {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
      }
    </style>
  </head>
  <body>
    <button id="countButton">
      <span class="shadow"></span>
      <span class="edge"></span>
      <span class="front text">Thả bướm</span>
    </button>

    <!-- Modal Structure -->
    <div class="modal" id="myModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <p id="monsterMessage">
              Có một con quái vật xuất hiện trong khu vườn!
            </p>
            <p>Bạn có muốn tiêu diệt nó không?</p>
            <button class="btn btn-danger" onclick="closeModal()">
              Sẵn sàng!
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Declare refreshIntervalId in global scope
      let refreshIntervalId;
      // Open the modal
      function openModal(
        message = "Có một con quái vật xuất hiện trong khu vườn!"
      ) {
        document.getElementById("monsterMessage").textContent = message;
        document.getElementById("myModal").style.display = "flex";
        clearInterval(refreshIntervalId);
      }

      // Close the modal
      function closeModal() {
        document.getElementById("myModal").style.display = "none";
      }
      function checkTrigger() {
        fetch("/triggerMonster")
          .then((response) => response.json())
          .then((data) => {
            console.log(data.message);
            if (data.message === "Monster triggered!") {
              console.log("Trigger");
              openModal();
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      window.onload = function () {
        checkTrigger();
        // Initialize the interval and store its ID in the global variable
        refreshIntervalId = setInterval(checkTrigger, 150); // Check every 150ms
      };

      document
        .getElementById("countButton")
        .addEventListener("click", function () {
          fetch("/countOne", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: "countOne" }),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("Success:", data);
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
